---
layout: post
title: Python requests - HTTP library. Examples
date: 2016-03-21 16:17:04.000000000 +00:00
type: post
published: true
status: publish
categories:
- coding
tags:
- Python
meta:
  _edit_last: '33175867'
  geo_public: '0'
  _rest_api_published: '1'
  _rest_api_client_id: '-1'
  _publicize_job_id: '20981677052'
author:
  login: siemic
  email: 
  display_name: siemic
  first_name: ''
  last_name: ''
---
<p>If you need to send some HTTP requests and that requires additional processing on your side maybe it'd be better to draft some script. If you happen to know python then you can try its <a href="http://docs.python-requests.org/en/master/">Requests</a> library. Some simple snippets that can be used are placed further.</p>
<h3>Set up a session</h3>
<pre>import requests
from requests import Request, Session
from requests.auth import HTTPBasicAuth

s = requests.Session()</pre>
<h4></h4>
<h3></h3>
<h3>Send POST request:</h3>
<pre>registrationData = {'registrationCode' :registrationCode ,'customerReference': customerRefNo}
 registrationResp=s.post(host + '/customer-account/register',headers = headers, data = registrationData)</pre>
<p>Just add required headers e.g</p>
<pre>headers = {
 'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/29.0.1547.62 Safari/537.36'
}</pre>
<h3>Send POST with json data</h3>
<pre>authorisationPayload = {"personRoles":[{"role":"Owner","personId":userId}],
 "personPrivileges":[{"privilegeNames":
 ["Full permissions","Amend ","No access - cs","No access - cs agree"],
 "personId":userId}]}</pre>
<pre>ra=s.post(host + '/organisation/' +str(businessID),headers = headers, json = authorisationPayload)</pre>
<h3>Dealing with <b>Cross-site request forgery</b></h3>
<p>If we have XSRF token added to requests we need to extract it.</p>
<pre>def getXsrf(cookies):
    for cookie in s.cookies:
       if cookie.name =='XSRF-TOKEN':
          return cookie.value</pre>
<p>and add it to our headers</p>
<pre>xsrf = getXsrf(s.cookies)
 headers['X-XSRF-TOKEN'] = xsrf</pre>
<h3>
Extract data from Json response:</h3>
<pre>
 if ( ra.status_code == 200 ):
   organisationID = ra.json()['_data'][0]['id'] 

</pre>
<p>In case of unverified HTTPS requests we can suppress warnings (if we really want it) :</p>
<pre>from requests.packages.urllib3.exceptions import InsecureRequestWarning
requests.packages.urllib3.disable_warnings(InsecureRequestWarning)</pre>
<p>We also probably need to add to our request this parameter  <em>verify=False</em><em><br />
</em>to skip verification of HTTPS certificate. Use it if needed of course.</p>
